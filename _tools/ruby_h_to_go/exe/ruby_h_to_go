#!/usr/bin/env ruby
# frozen_string_literal: true

# Convert Ruby C function definition to Go source and dump to dist/
#
# Usage:
#   ./ruby_h_to_go -H path/to/ruby/header/dir

require "optparse"
require "fileutils"

require_relative "../lib/ruby_h_to_go"

header_dir = nil
dist_dir = nil

DEFAULT_RUBY_HEADER_DIR = RbConfig::CONFIG["rubyhdrdir"]
DEFAULT_DIST_DIR = File.expand_path("../dist", __dir__)

opt = OptionParser.new
opt.on("-H", "--header-dir HEADER_DIR", "ruby header dir (default: #{DEFAULT_RUBY_HEADER_DIR})") { |v| header_dir = v }

opt.on("-D", "--dist-dir DIST_DIR", "dist dir for auto-generated Go code (default: #{DEFAULT_DIST_DIR})") do |v|
  dist_dir = v
end

opt.parse!(ARGV)

# Use default header file and include paths
header_dir ||= DEFAULT_RUBY_HEADER_DIR

dist_dir ||= DEFAULT_DIST_DIR

RubyHToGo::Cli.new(header_dir:, dist_dir:).perform
